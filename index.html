<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hijyen Bilgi SÄ±navÄ±</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom scrollbar for a nicer look */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1f2937; /* Dark gray */
        }
        ::-webkit-scrollbar-thumb {
            background: #4b5563; /* Medium gray */
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6b7280; /* Light gray */
        }
        /* Using Inter font for a modern look */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Base class for option buttons */
        .option-button {
            transition: all 0.2s ease-in-out;
            cursor: pointer;
        }
        /* Animation for feedback area */
        @keyframes fadeInScale {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        .feedback-area-visible {
            animation: fadeInScale 0.3s ease-out forwards;
        }
    </style>
    <script>
        // Tailwind configuration for custom colors
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary': '#10b981', // Emerald green
                        'secondary': '#374151', // Dark Gray
                        'danger': '#ef4444', // Red
                        'success': '#22c55e', // Green
                        'info': '#3b82f6', // Blue (for selection)
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen flex items-center justify-center p-4">

    <div id="app-container" class="w-full max-w-xl bg-gray-800 shadow-2xl rounded-xl p-6 md:p-8 space-y-6">
        
        <header class="text-center mb-6">
            <h1 class="text-3xl font-extrabold text-primary">Hijyen SertifikasÄ± Bilgi SÄ±navÄ±</h1>
            <p class="text-gray-400 mt-1">Bilgilerinizi test edin ve yanlÄ±ÅŸ cevaplarÄ± tekrar Ã§Ã¶zÃ¼n.</p>
        </header>

        <!-- Question Area -->
        <div id="quiz-area" class="space-y-6">
            
            <!-- Question Card -->
            <div id="question-card" class="bg-gray-700 p-4 rounded-lg shadow-inner border border-gray-600">
                <p id="question-number" class="text-sm font-medium text-primary mb-2"></p>
                <p id="question-text" class="text-xl font-semibold"></p>
            </div>

            <!-- Options Area -->
            <div id="options-container" class="grid grid-cols-1 gap-3">
                <!-- Option buttons will be injected here -->
            </div>

            <!-- Feedback & Explanation Area -->
            <div id="feedback-area" class="hidden p-4 rounded-lg mt-4 transition duration-300">
                <p id="feedback-message" class="font-bold mb-2"></p>
                <div id="explanation-container" class="text-sm italic text-gray-300"></div>
            </div>

            <!-- Action Buttons -->
            <div id="action-buttons" class="flex flex-col space-y-3 pt-4">
                <button id="submit-button" onclick="checkAnswer()" class="w-full bg-primary hover:bg-emerald-600 text-white font-bold py-3 rounded-lg shadow-lg transition duration-200 uppercase">GÃ¶nder (Cevapla)</button>
                <div class="grid grid-cols-2 gap-3">
                    <button id="reshuffle-button" onclick="reshuffleAnswers()" class="bg-secondary hover:bg-gray-600 text-white text-sm font-medium py-2 rounded-lg transition duration-200">CevaplarÄ± KarÄ±ÅŸtÄ±r</button>
                    <button id="next-button" onclick="nextQuestion()" class="bg-info hover:bg-blue-600 text-white text-sm font-medium py-2 rounded-lg transition duration-200 hidden">Sonraki Soru</button>
                </div>
            </div>
        </div>

        <!-- Results Area -->
        <div id="results-area" class="hidden text-center space-y-6">
            <h2 class="text-4xl font-extrabold text-primary">SÄ±nav SonuÃ§larÄ±</h2>
            <div class="grid grid-cols-2 gap-4">
                <div class="bg-gray-700 p-4 rounded-lg shadow-lg">
                    <p class="text-gray-400 text-sm">DoÄŸru Cevaplar</p>
                    <p id="correct-count" class="text-4xl font-bold text-success mt-1"></p>
                </div>
                <div class="bg-gray-700 p-4 rounded-lg shadow-lg">
                    <p class="text-gray-400 text-sm">BaÅŸarÄ± YÃ¼zdesi</p>
                    <p id="score-percentage" class="text-4xl font-bold text-info mt-1"></p>
                </div>
            </div>
            <p id="results-message" class="text-lg font-medium"></p>
            
            <!-- This button is managed to show only when there are wrong answers -->
            <button id="retake-wrong-button" onclick="retakeWrongAnswers()" class="w-full bg-danger hover:bg-red-600 text-white font-bold py-3 rounded-lg shadow-lg transition duration-200 uppercase mt-4 hidden">YanlÄ±ÅŸlarÄ± Tekrar Ã‡Ã¶z</button>
            <button onclick="startQuiz()" class="w-full bg-gray-600 hover:bg-gray-500 text-white font-bold py-3 rounded-lg shadow-lg transition duration-200 uppercase mt-2">SÄ±nava Yeniden BaÅŸla</button>
        </div>
        
        <!-- Custom Modal for Alerts (replacing window.alert) -->
        <div id="custom-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50">
            <div class="bg-gray-700 p-6 rounded-lg shadow-2xl max-w-sm w-full text-center">
                <p id="modal-message" class="text-lg font-semibold text-white mb-4"></p>
                <button onclick="closeModal()" class="bg-primary hover:bg-emerald-600 text-white font-bold py-2 px-4 rounded-lg transition duration-200">Tamam</button>
            </div>
        </div>

    </div>

    <script>
        // Use a consistent structure for all questions
        const ALL_QUESTIONS_RAW = [
            { q: "Hijyen nedir?", options: ["Sadece elleri yÄ±kamak", "HastalÄ±k yapÄ±cÄ± mikroorganizmalardan korunma yÃ¶ntemi", "Yemek piÅŸirme yÃ¶ntemi", "Sadece gÄ±da hazÄ±rlama aÅŸamasÄ±"], answerIndex: 1, explanation: "Hijyen, hastalÄ±k yapÄ±cÄ± mikroorganizmalardan korunma ve saÄŸlÄ±klÄ± yaÅŸamÄ± sÃ¼rdÃ¼rme yÃ¶ntemlerinin tÃ¼mÃ¼dÃ¼r." },
            { q: "Mikroorganizmalar nedir?", options: ["GÃ¶zle gÃ¶rÃ¼lebilen canlÄ±lar", "GÃ¶zle gÃ¶rÃ¼lemeyen, mikroskopla gÃ¶rÃ¼lebilen canlÄ±lar", "Bitkiler", "Hayvanlar"], answerIndex: 1, explanation: "Mikroorganizmalar, Ã§Ä±plak gÃ¶zle gÃ¶rÃ¼lemeyen ve mikroskop kullanarak incelenebilen canlÄ±lardÄ±r." },
            { q: "GÄ±da zehirlenmesi nedir?", options: ["YanlÄ±ÅŸ piÅŸirilen yemek", "GÄ±da yoluyla alÄ±nan zararlÄ± mikroorganizmalar veya toksinlerin neden olduÄŸu hastalÄ±k", "Yetersiz gÄ±da tÃ¼ketimi", "AÅŸÄ±rÄ± tuz kullanÄ±mÄ±"], answerIndex: 1, explanation: "GÄ±da zehirlenmesi, kontamine olmuÅŸ gÄ±dalardan alÄ±nan mikroorganizmalar veya toksinler nedeniyle ortaya Ã§Ä±kan saÄŸlÄ±k sorunudur." },
            { q: "KiÅŸisel hijyenin Ã¶nemi nedir?", options: ["Sadece gÃ¼zel gÃ¶rÃ¼nmek iÃ§in", "HastalÄ±klardan korunmak ve saÄŸlÄ±ÄŸÄ± korumak iÃ§in", "Daha iyi kokmak iÃ§in", "Sadece iÅŸ yerinde temiz olmak iÃ§in"], answerIndex: 1, explanation: "KiÅŸisel hijyen, bireylerin hastalÄ±klardan korunmalarÄ± ve genel saÄŸlÄ±klarÄ±nÄ± korumalarÄ± iÃ§in gereklidir." },
            { q: "El yÄ±kama sÃ¼resi ne kadar olmalÄ±dÄ±r?", options: ["5 saniye", "10 saniye", "20 saniye", "1 dakika"], answerIndex: 2, explanation: "Etkili bir el yÄ±kama iÅŸlemi, ellerin tÃ¼m yÃ¼zeylerinin iyice temizlenebilmesi iÃ§in en az 20 saniye sÃ¼rmelidir." },
            { q: "Ã‡apraz bulaÅŸma nedir?", options: ["FarklÄ± tÃ¼rde gÄ±dalarÄ±n aynÄ± anda piÅŸirilmesi", "Temiz ve kirli gÄ±dalarÄ±n temas etmesi sonucu mikroorganizmalarÄ±n bulaÅŸmasÄ±", "GÄ±dalarÄ±n aÅŸÄ±rÄ± Ä±sÄ±tÄ±lmasÄ±", "GÄ±dalarÄ±n soÄŸukta saklanmasÄ±"], answerIndex: 1, explanation: "Ã‡apraz bulaÅŸma, temiz gÄ±dalarÄ±n kirli gÄ±dalarla temas ederek mikroorganizmalarÄ±n bulaÅŸmasÄ± anlamÄ±na gelir." },
            { q: "GÄ±da hijyeninde kritik kontrol noktasÄ± nedir?", options: ["Yemek piÅŸirme sÃ¼resi", "GÄ±danÄ±n saklanma sÄ±caklÄ±ÄŸÄ±", "GÄ±danÄ±n paketlenmesi", "Yemek sunumu"], answerIndex: 1, explanation: "GÄ±da hijyeninde kritik kontrol noktalarÄ±, gÄ±danÄ±n mikroorganizmalarÄ±n Ã§oÄŸalmasÄ±nÄ± engellemek iÃ§in belirli sÄ±caklÄ±k aralÄ±klarÄ±nda saklanmasÄ±nÄ± iÃ§erir." },
            { q: "Hijyen eÄŸitimi neden Ã¶nemlidir?", options: ["Daha fazla mÃ¼ÅŸteri Ã§ekmek iÃ§in", "Ã‡alÄ±ÅŸanlarÄ±n bilinÃ§lenmesi ve iÅŸ saÄŸlÄ±ÄŸÄ± gÃ¼venliÄŸinin artÄ±rÄ±lmasÄ± iÃ§in", "Ä°ÅŸ yerini temiz tutmak iÃ§in", "Yasal zorunluluk olmadÄ±ÄŸÄ± iÃ§in"], answerIndex: 1, explanation: "Hijyen eÄŸitimi, Ã§alÄ±ÅŸanlarÄ±n bilinÃ§lenmesi ve iÅŸ saÄŸlÄ±ÄŸÄ± gÃ¼venliÄŸinin artÄ±rÄ±lmasÄ± amacÄ±yla verilmektedir." },
            { q: "Hangi durumda eller yeniden yÄ±kanmalÄ±dÄ±r?", options: ["Yemek yedikten sonra", "Yemek hazÄ±rlamaya baÅŸlamadan Ã¶nce", "Tuvalet kullanÄ±mÄ±ndan sonra", "Hepsi"], answerIndex: 3, explanation: "Eller, yemek yemeden Ã¶nce ve sonra, yemek hazÄ±rlamaya baÅŸlamadan Ã¶nce ve tuvalet kullanÄ±mÄ±ndan sonra mutlaka yÄ±kanmalÄ±dÄ±r." },
            { q: "Mikroorganizmalar en Ã§ok nerede bulunur?", options: ["SÄ±cak ve kuru yerlerde", "SoÄŸuk ve kuru yerlerde", "SÄ±cak ve nemli yerlerde", "SoÄŸuk ve nemli yerlerde"], answerIndex: 2, explanation: "Mikroorganizmalar, sÄ±cak ve nemli ortamlarda hÄ±zlÄ± bir ÅŸekilde Ã§oÄŸalÄ±r ve yayÄ±lÄ±r." },
            { q: "GÄ±da hijyeni neden Ã¶nemlidir?", options: ["GÄ±dalarÄ±n lezzetini artÄ±rmak iÃ§in", "GÄ±da kaynaklÄ± hastalÄ±klarÄ± Ã¶nlemek iÃ§in", "GÄ±dalarÄ±n renklerini korumak iÃ§in", "GÄ±dalarÄ±n maliyetini dÃ¼ÅŸÃ¼rmek iÃ§in"], answerIndex: 1, explanation: "GÄ±da hijyeni, gÄ±da kaynaklÄ± hastalÄ±klarÄ±n Ã¶nlenmesi iÃ§in kritik bir Ã¶neme sahiptir." },
            { q: "KiÅŸisel hijyenin iÅŸ yerindeki etkisi nedir?", options: ["Ã‡alÄ±ÅŸanlarÄ±n gÃ¶rÃ¼nÃ¼mÃ¼nÃ¼ iyileÅŸtirir", "Ã‡alÄ±ÅŸanlarÄ±n moralini artÄ±rÄ±r", "Ã‡alÄ±ÅŸanlar arasÄ±ndaki hastalÄ±klarÄ±n yayÄ±lmasÄ±nÄ± Ã¶nler", "Ã‡alÄ±ÅŸanlarÄ±n daha iyi kokmasÄ±nÄ± saÄŸlar"], answerIndex: 2, explanation: "KiÅŸisel hijyen, iÅŸ yerinde hastalÄ±klarÄ±n yayÄ±lmasÄ±nÄ± Ã¶nleyerek genel saÄŸlÄ±k durumunu iyileÅŸtirir." },
            { q: "Hangi hijyen kuralÄ± doÄŸru deÄŸildir?", options: ["Elleri sÄ±k sÄ±k yÄ±kamak", "Ã‡iÄŸ ve piÅŸmiÅŸ gÄ±dalarÄ± ayrÄ± tutmak", "Temizlik bezlerini her gÃ¼n deÄŸiÅŸtirmek", "Ã‡iÄŸ gÄ±dalarÄ± buzdolabÄ± dÄ±ÅŸÄ±nda saklamak"], answerIndex: 3, explanation: "Ã‡iÄŸ gÄ±dalarÄ±n buzdolabÄ±nda saklanmasÄ± gerekir, aksi halde bakteri Ã¼reme riski artar." },
            { q: "Ä°ÅŸ yerinde hijyen eÄŸitimi almayan Ã§alÄ±ÅŸanlar ne tÃ¼r risklerle karÅŸÄ± karÅŸÄ±ya kalÄ±r?", options: ["Ä°ÅŸ gÃ¼venliÄŸi kurallarÄ±nÄ± ihlal etme riski", "GÄ±da zehirlenmesi riskinin artmasÄ±", "Ä°ÅŸ kazalarÄ± riski", "Hepsi"], answerIndex: 3, explanation: "Hijyen eÄŸitimi almayan Ã§alÄ±ÅŸanlar, iÅŸ gÃ¼venliÄŸi kurallarÄ±nÄ± ihlal edebilir, gÄ±da zehirlenmesi riskini artÄ±rabilir ve iÅŸ kazalarÄ±na neden olabilir." },
            { q: "Hangi temizlik malzemesi mikroorganizmalarÄ± yok etmede en etkilidir?", options: ["Su", "Sabun", "Dezenfektan", "Havlu"], answerIndex: 2, explanation: "Dezenfektanlar, mikroorganizmalarÄ± etkili bir ÅŸekilde yok eder ve hijyen saÄŸlar." },
            { q: "GÄ±dalarÄ±n saklanma sÄ±caklÄ±ÄŸÄ± kaÃ§ derece olmalÄ±dÄ±r?", options: ["0-5Â°C", "10-15Â°C", "20-25Â°C", "30-35Â°C"], answerIndex: 0, explanation: "GÄ±dalarÄ±n bozulmamasÄ± ve mikroorganizmalarÄ±n Ã¼rememesi iÃ§in 0-5Â°C aralÄ±ÄŸÄ±nda saklanmasÄ± gerekmektedir." },
            { q: "Hangi durumda maske kullanÄ±lmalÄ±dÄ±r?", options: ["Yemek hazÄ±rlarken", "Temizlik yaparken", "Hasta biriyle temas ederken", "Hepsi"], answerIndex: 3, explanation: "Maske kullanÄ±mÄ±, yemek hazÄ±rlarken, temizlik yaparken ve hasta biriyle temas ederken mikroorganizmalarÄ±n yayÄ±lmasÄ±nÄ± Ã¶nlemek iÃ§in Ã¶nemlidir." },
            { q: "GÄ±da zehirlenmesinin belirtileri nelerdir?", options: ["KarÄ±n aÄŸrÄ±sÄ± ve ishal", "BaÅŸ aÄŸrÄ±sÄ±", "AteÅŸ", "Hepsi"], answerIndex: 3, explanation: "GÄ±da zehirlenmesinin belirtileri arasÄ±nda karÄ±n aÄŸrÄ±sÄ±, ishal, baÅŸ aÄŸrÄ±sÄ± ve ateÅŸ gibi semptomlar bulunur." },
            { q: "Hangi hijyen uygulamasÄ± doÄŸru deÄŸildir?", options: ["Ã‡iÄŸ ve piÅŸmiÅŸ gÄ±dalarÄ± aynÄ± anda hazÄ±rlamak", "Elleri yemekten Ã¶nce yÄ±kamak", "Ã‡iÄŸ gÄ±dalarÄ± buzdolabÄ±nda saklamak", "Yemek hazÄ±rlamadan Ã¶nce mutfaÄŸÄ± temizlemek"], answerIndex: 0, explanation: "Ã‡iÄŸ ve piÅŸmiÅŸ gÄ±dalarÄ±n aynÄ± anda hazÄ±rlanmasÄ±, Ã§apraz bulaÅŸmaya neden olarak hijyen sorunlarÄ± yaratabilir." },
            { q: "Hijyen sertifikasÄ± almak iÃ§in gereken en Ã¶nemli adÄ±m nedir?", options: ["Sadece baÅŸvurmak", "Hijyen eÄŸitimi almak ve sÄ±navÄ± geÃ§mek", "Ãœcret Ã¶demek", "Referans gÃ¶stermek"], answerIndex: 1, explanation: "Hijyen sertifikasÄ± almak iÃ§in en Ã¶nemli adÄ±m, hijyen eÄŸitimi alarak sÄ±navda baÅŸarÄ±lÄ± olmaktÄ±r." },
            { q: "Hangi durumda gÄ±da kontaminasyonu riski artar?", options: ["GÄ±dalarÄ± doÄŸru sÄ±caklÄ±kta saklamak", "Ã‡iÄŸ ve piÅŸmiÅŸ gÄ±dalarÄ± aynÄ± yerde saklamak", "GÄ±dalarÄ± temiz kaplarda saklamak", "GÄ±dalarÄ± uygun ambalajlarda saklamak"], answerIndex: 1, explanation: "Ã‡iÄŸ ve piÅŸmiÅŸ gÄ±dalarÄ±n aynÄ± yerde saklanmasÄ±, Ã§apraz bulaÅŸma riskini artÄ±rÄ±r." },
            { q: "GÄ±da hijyeninde doÄŸru saklama koÅŸullarÄ± nedir?", options: ["GÄ±dalarÄ± aÃ§Ä±kta bÄ±rakmak", "GÄ±dalarÄ± buzdolabÄ±nda saklamak", "GÄ±dalarÄ± odun dolapta saklamak", "GÄ±dalarÄ± plastik kaplarda saklamak"], answerIndex: 1, explanation: "GÄ±dalarÄ±n bozulmamasÄ± ve mikroorganizmalarÄ±n Ã¼rememesi iÃ§in buzdolabÄ±nda saklanmasÄ± gerekmektedir." },
            { q: "Hangi hijyen kuralÄ± iÅŸ yerinde uygulanmalÄ±dÄ±r?", options: ["Elleri yÄ±kamadan yemek hazÄ±rlamak", "Temizlik malzemelerini ayrÄ± yerlerde saklamak", "Ã‡alÄ±ÅŸanlarÄ±n aynÄ± kÄ±yafetleri giymesi", "Temizlik yaparken eldiven kullanmak"], answerIndex: 3, explanation: "Temizlik yaparken eldiven kullanmak, kimyasallardan ve mikroorganizmalardan korunmayÄ± saÄŸlar." },
            { q: "Hijyen eÄŸitimi alan Ã§alÄ±ÅŸanlarÄ±n faydasÄ± nedir?", options: ["Ä°ÅŸ verimliliÄŸinin artmasÄ±", "Daha temiz iÅŸ ortamÄ±", "Daha az iÅŸ kazasÄ±", "Hepsi"], answerIndex: 3, explanation: "Hijyen eÄŸitimi alan Ã§alÄ±ÅŸanlar, iÅŸ verimliliÄŸini artÄ±rÄ±r, iÅŸ ortamÄ±nÄ±n temizliÄŸini saÄŸlar ve iÅŸ kazalarÄ±nÄ± azaltÄ±r." },
            { q: "Mikroorganizma Ã¼remesini Ã¶nlemek iÃ§in ne yapÄ±lmalÄ±dÄ±r?", options: ["GÄ±dalarÄ± oda sÄ±caklÄ±ÄŸÄ±nda bÄ±rakmak", "GÄ±dalarÄ± uygun sÄ±caklÄ±kta saklamak", "GÄ±dalarÄ± aÃ§Ä±kta bÄ±rakmak", "GÄ±dalarÄ± gÃ¼neÅŸte kurutmak"], answerIndex: 1, explanation: "Mikroorganizma Ã¼remesini Ã¶nlemek iÃ§in gÄ±dalarÄ±n uygun sÄ±caklÄ±kta saklanmasÄ± gerekmektedir." },
            { q: "Hijyen sÄ±navÄ± sorularÄ± neyi kapsar?", options: ["Temel hijyen bilgisi", "GÄ±da hijyeni", "KiÅŸisel hijyen", "Hepsi"], answerIndex: 3, explanation: "Hijyen sÄ±navÄ± sorularÄ±, temel hijyen bilgisi, gÄ±da hijyeni ve kiÅŸisel hijyen konularÄ±nÄ± kapsar." },
            { q: "Hangi durumda hijyen eÄŸitimi tekrar edilmelidir?", options: ["Her yÄ±l", "Her Ã¼Ã§ yÄ±lda bir", "BeÅŸ yÄ±lda bir", "Yedi yÄ±lda bir"], answerIndex: 1, explanation: "Hijyen eÄŸitimi, bilgilerin gÃ¼ncellenmesi ve tazelenmesi amacÄ±yla her Ã¼Ã§ yÄ±lda bir tekrar edilmelidir." },
            { q: "Hijyen belgesi hangi sektÃ¶rler iÃ§in gereklidir?", options: ["GÄ±da sektÃ¶rÃ¼", "SaÄŸlÄ±k sektÃ¶rÃ¼", "Temizlik sektÃ¶rÃ¼", "Hepsi"], answerIndex: 3, explanation: "Hijyen belgesi, gÄ±da, saÄŸlÄ±k ve temizlik gibi birÃ§ok sektÃ¶rde gereklidir." },
            { q: "Hangi hijyen uygulamasÄ± yanlÄ±ÅŸtÄ±r?", options: ["GÄ±dalarÄ± uygun kaplarda saklamak", "Elleri yÄ±kamadan yemek hazÄ±rlamak", "Temizlik sÄ±rasÄ±nda eldiven kullanmak", "Ã‡iÄŸ ve piÅŸmiÅŸ gÄ±dalarÄ± ayrÄ± yerlerde saklamak"], answerIndex: 1, explanation: "Elleri yÄ±kamadan yemek hazÄ±rlamak, hijyen kurallarÄ±na aykÄ±rÄ±dÄ±r ve kontaminasyon riskini artÄ±rÄ±r." },
            { q: "Hijyen belgesi almak iÃ§in hangi sÄ±navÄ± geÃ§mek gereklidir?", options: ["Sadece uygulama sÄ±navÄ±", "Teorik sÄ±nav", "Hem teorik hem uygulama sÄ±navÄ±", "Sadece mÃ¼lakat"], answerIndex: 2, explanation: "Hijyen belgesi almak iÃ§in hem teorik hem de uygulama sÄ±navlarÄ±nÄ± geÃ§mek gereklidir." }
        ];

        let ALL_QUESTIONS_MAPPED; // Stores questions with their immutable original index
        let currentQuestions = []; // The list of questions currently being asked (subset or full)
        let currentIndex = 0;
        // Stores results: { originalQIndex: number, chosenIndex: number, correctIndex: number, isCorrect: boolean }
        let userAnswers = []; 
        let isAnswered = false;
        
        // Element selectors
        const quizArea = document.getElementById('quiz-area');
        const resultsArea = document.getElementById('results-area');
        const questionTextEl = document.getElementById('question-text');
        const questionNumberEl = document.getElementById('question-number');
        const optionsContainer = document.getElementById('options-container');
        const feedbackArea = document.getElementById('feedback-area');
        const feedbackMessageEl = document.getElementById('feedback-message');
        const explanationContainer = document.getElementById('explanation-container');
        const submitButton = document.getElementById('submit-button');
        const nextButton = document.getElementById('next-button');
        const reshuffleButton = document.getElementById('reshuffle-button');
        const retakeWrongButton = document.getElementById('retake-wrong-button');
        const modal = document.getElementById('custom-modal');
        const modalMessage = document.getElementById('modal-message');
        
        // Custom Alert/Modal function
        function showModal(message) {
            modalMessage.textContent = message;
            modal.classList.remove('hidden');
        }

        function closeModal() {
            modal.classList.add('hidden');
        }

        // Utility: Shuffles an array in place (Fisher-Yates)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // Utility: Returns the letter (a, b, c, d) for an index (0, 1, 2, 3)
        function getOptionLetter(index) {
            return String.fromCharCode(97 + index);
        }

        // Main function to start the quiz
        function startQuiz(retakeOnly = false) {
            
            if (retakeOnly) {
                // 1. Get the indices of questions that were previously answered incorrectly
                const wrongOriginalIndices = userAnswers.filter(a => !a.isCorrect).map(a => a.originalQIndex);
                
                if (wrongOriginalIndices.length === 0) {
                    showModal('Tebrikler! Ã–nceki denemede tÃ¼m sorularÄ± doÄŸru cevapladÄ±nÄ±z.');
                    // If no wrong answers, go back to results view
                    showResults(); 
                    return;
                }
                
                // 2. Filter the master list to create the retake quiz set
                currentQuestions = ALL_QUESTIONS_MAPPED.filter(q => wrongOriginalIndices.includes(q.originalIndex));
                
                // 3. Keep only the correct answers recorded, clear incorrect ones for the new session
                userAnswers = userAnswers.filter(a => a.isCorrect); 
                
            } else {
                // Normal start (all questions)
                currentQuestions = [...ALL_QUESTIONS_MAPPED];
                // Shuffle the entire question list at the start for variety
                shuffleArray(currentQuestions); 
                userAnswers = [];
            }

            currentIndex = 0;
            isAnswered = false;

            quizArea.classList.remove('hidden');
            resultsArea.classList.add('hidden');
            retakeWrongButton.classList.add('hidden'); // Ensure retake button is hidden during the quiz
            
            renderQuestion();
        }

        // Renders the current question and shuffles its options
        function renderQuestion() {
            if (currentIndex >= currentQuestions.length) {
                showResults();
                return;
            }

            const currentQ = currentQuestions[currentIndex];

            // 1. Reset UI state
            optionsContainer.innerHTML = '';
            feedbackArea.classList.add('hidden');
            feedbackArea.classList.remove('feedback-area-visible');
            nextButton.classList.add('hidden');
            submitButton.classList.remove('hidden');
            submitButton.disabled = false;
            reshuffleButton.disabled = false;
            isAnswered = false;
            
            // 2. Display question text and number
            const totalQ = currentQuestions.length;
            const currentNumber = currentIndex + 1;
            questionNumberEl.textContent = `Soru ${currentNumber} / ${totalQ}`;
            questionTextEl.textContent = currentQ.q;

            // 3. Prepare shuffled options and map back to original indices
            const originalOptions = currentQ.options.map((text, originalIndex) => ({ text, originalIndex }));
            
            // Only shuffle if it hasn't been done for this question in the current session
            if (!currentQ.shuffledOptions) {
                shuffleArray(originalOptions);
                currentQ.shuffledOptions = originalOptions; 
            }

            // 4. Render options
            currentQ.shuffledOptions.forEach((option, shuffledIndex) => {
                const btn = document.createElement('button');
                btn.className = 'option-button w-full text-left bg-gray-700 hover:bg-gray-600 text-gray-100 p-3 rounded-lg shadow transition duration-150 ease-in-out font-medium border border-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-info';
                btn.setAttribute('data-shuffled-index', shuffledIndex);
                btn.setAttribute('data-original-index', option.originalIndex);
                btn.innerHTML = `<span class="font-bold text-primary mr-2">${getOptionLetter(shuffledIndex)}.</span> ${option.text}`;
                btn.onclick = () => selectOption(btn);
                optionsContainer.appendChild(btn);
            });
        }

        // Handles option selection
        function selectOption(selectedButton) {
            if (isAnswered) return;

            // Remove selection from all, add to selected
            document.querySelectorAll('.option-button').forEach(btn => {
                btn.classList.remove('bg-info', 'ring-2', 'ring-offset-2', 'ring-offset-gray-800');
            });
            selectedButton.classList.add('bg-info', 'ring-2', 'ring-offset-2', 'ring-offset-gray-800');
            
            // Store the chosen original index temporarily on the question object
            currentQuestions[currentIndex].chosenOriginalIndex = parseInt(selectedButton.getAttribute('data-original-index'));
        }

        // Handles submission
        function checkAnswer() {
            if (isAnswered) return;

            const currentQ = currentQuestions[currentIndex];
            const chosenIndex = currentQ.chosenOriginalIndex;

            if (chosenIndex === undefined) {
                showModal('LÃ¼tfen bir cevap seÃ§in.');
                return;
            }

            isAnswered = true;
            submitButton.classList.add('hidden');
            nextButton.classList.remove('hidden');
            reshuffleButton.disabled = true;

            const correctAnswerIndex = currentQ.answerIndex;
            const isCorrect = chosenIndex === correctAnswerIndex;
            
            // Store the result using the reliable originalIndex
            userAnswers.push({
                originalQIndex: currentQ.originalIndex, 
                chosenIndex: chosenIndex,
                correctIndex: correctAnswerIndex,
                isCorrect: isCorrect
            });

            // 1. Highlight options
            document.querySelectorAll('.option-button').forEach(btn => {
                const originalIndex = parseInt(btn.getAttribute('data-original-index'));
                
                // Find the correct option and highlight it green
                if (originalIndex === correctAnswerIndex) {
                    btn.classList.remove('bg-gray-700', 'bg-info', 'ring-2', 'ring-offset-2');
                    btn.classList.add('bg-success', 'ring-2', 'ring-green-400');
                } 
                
                // If the user chose this option AND it was wrong, highlight it red
                else if (originalIndex === chosenIndex && !isCorrect) {
                    btn.classList.remove('bg-gray-700', 'bg-info');
                    btn.classList.add('bg-danger', 'ring-2', 'ring-red-400');
                }
                
                // Disable all buttons after submission
                btn.disabled = true;
            });

            // 2. Show feedback and explanation
            feedbackArea.classList.remove('hidden');
            feedbackArea.classList.add('feedback-area-visible'); // Trigger animation
            
            if (isCorrect) {
                feedbackArea.className = 'feedback-area-visible p-4 rounded-lg mt-4 bg-success text-white transition duration-300 shadow-md';
                feedbackMessageEl.textContent = 'DoÄŸru Cevap! ðŸ¥³';
            } else {
                feedbackArea.className = 'feedback-area-visible p-4 rounded-lg mt-4 bg-danger text-white transition duration-300 shadow-md';
                feedbackMessageEl.textContent = 'YanlÄ±ÅŸ Cevap. ðŸ˜”';
            }
            explanationContainer.innerHTML = `<strong>GerekÃ§e:</strong> ${currentQ.explanation}`;
        }

        // Moves to the next question
        function nextQuestion() {
            if (!isAnswered) return;
            currentIndex++;
            
            // Clear selection properties before rendering the next question
            if (currentQuestions[currentIndex]) {
                 currentQuestions[currentIndex].chosenOriginalIndex = undefined;
                 currentQuestions[currentIndex].shuffledOptions = undefined;
            }
            
            renderQuestion();
        }

        // Reshuffles the options of the current question
        function reshuffleAnswers() {
            if (isAnswered) return;
            // Clear the existing shuffled options to force re-shuffle
            currentQuestions[currentIndex].shuffledOptions = undefined;
            currentQuestions[currentIndex].chosenOriginalIndex = undefined; 
            renderQuestion();
        }

        // Shows the final results screen
        function showResults() {
            quizArea.classList.add('hidden');
            resultsArea.classList.remove('hidden');

            const correctCount = userAnswers.filter(a => a.isCorrect).length;
            const totalAnswered = ALL_QUESTIONS_MAPPED.length; // Always use the total number of unique questions
            const scorePercentage = ((correctCount / totalAnswered) * 100).toFixed(1);

            document.getElementById('correct-count').textContent = `${correctCount}`;
            document.getElementById('score-percentage').textContent = `${scorePercentage}%`;
            
            const missedCount = totalAnswered - correctCount;

            let message = '';
            if (missedCount === 0) {
                message = 'MÃ¼kemmel! TÃ¼m sorularÄ± doÄŸru cevapladÄ±nÄ±z. ðŸ’¯';
                retakeWrongButton.classList.add('hidden');
            } else if (scorePercentage >= 70) {
                message = `Tebrikler, ${totalAnswered} sorudan ${correctCount} tanesini doÄŸru bildiniz. Ä°yi bir performans!`;
                retakeWrongButton.classList.remove('hidden');
            } else {
                message = `Tekrar Ã§alÄ±ÅŸmanÄ±z gerekebilir. ${totalAnswered} sorudan ${correctCount} tanesini doÄŸru bildiniz.`;
                retakeWrongButton.classList.remove('hidden');
            }

            document.getElementById('results-message').textContent = message;
        }

        // Starts a new quiz session using only the previously missed questions
        function retakeWrongAnswers() {
            startQuiz(true);
        }

        // Initialization: Map questions and start the quiz
        function initializeApp() {
            // Map the raw questions to add a stable original index
            ALL_QUESTIONS_MAPPED = ALL_QUESTIONS_RAW.map((q, index) => ({ 
                ...q, 
                originalIndex: index 
            }));
            startQuiz();
        }

        // Use DOMContentLoaded to ensure the script runs after all elements are available
        document.addEventListener('DOMContentLoaded', initializeApp);

    </script>

</body>
</html>

